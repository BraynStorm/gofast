<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GOFast</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <link href="/static/ui/icons/favicon.svg" rel="icon" />
    <link href="/static/ui/index.css" rel="stylesheet" />

    <!-- ROBOTO -->
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"> -->

    <!-- ROBOTO CONDENSED -->
    <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@100..900&display=swap"
      rel="stylesheet"> -->

    <script defer src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script defer src="/static/ui/gofast.js"></script>
    <script defer src="/static/ui/graph.js"></script>
    <script defer src="https://unpkg.com/alpinejs"></script>
  </head>

  <body x-data="GOFAST">
    <!-- TODO: Graphs! -->
    <!-- <div id="container"></div> -->

    <main id="main">
      <!-- Make a side-panel -->
      <aside class="left edit"
        x-show="left_panel.mode === 'edit'"
        x-transition:enter="enter"
        x-transition:enter-end="enterend"
        x-transition:enter-start="enterstart"
        x-transition:leave="leave"
        x-transition:leave-end="leaveend"
        x-transition:leave-start="leavestart">
        <span>Edit:</span>
        <span x-text="display_key(m_et.key)" class="et_key"></span>
        <input class="et_title"
          name="et_title"
          x-model="m_et.title" />
        <div>
          <select class="et_priority" name="et_priority"
            x-model="m_et.priority">
            <template x-for="(priority, id) in name_priorities" :key="id">
              <option :selected="m_et.priority === id"
                :value="id"
                x-text="priority">
              </option>
            </template>
          </select>
          <select class="et_type" name="et_type" x-model="m_et.type">
            <template x-for="(type, id) in name_types" :key="id">
              <option :value="id" x-text="type"></option>
            </template>
          </select>
          <select class="et_status" name="et_status" x-model="m_et.status">
            <template x-for="(status, id) in name_statuses" :key="id">
              <option :value="id" x-text="status"></option>
            </template>
          </select>
          <select class="et_parent" name="et_parent" x-model="m_et.parent">
            <option value>No Parent</option>
            <template x-for="(t, key) in tickets" :key="key">
              <option
                :value="key"
                x-text="display_key(key) + ': ' + t.title.substring(0, 14) + '...'"></option>
            </template>
          </select>
        </div>
        <textarea class="description"
          name="et_description"
          placeholder="Description..."
          x-model="m_et.description"></textarea>
        <button @click="stop_edit_ticket" class="btn-cross"></button>
        <button @click="stop_edit_ticket" class="btn-checkmark"></button>
      </aside>
      <!-- <template x-if="left_panel.mode === ''">
          <aside class="left hidden"></aside>
        </template> -->

      <section>
        <template x-if="inset.mode === 'create'">
          <!-- Make new ticket -->
          <nav class="inset">
            <span>New:</span>
            <!-- TODO: Make an expand button to enlarge the inset. -->
            <input :value="display_key(likely_next_ticket_number())"
              class="nt_key"
              disabled
              name="nt_key" />
            <input class="nt_title"
              name="nt_title"
              placeholder="Title..."
              x-model="m_nt.title" />
            <input class="nt_title"
              name="nt_description"
              placeholder="Description..."
              x-model="m_nt.description" />
            <!-- TODO: Add a 'search' field/dropdown combo thing for finding parents. -->
            <button @click="ui_create_ticket" class="btn-plus"></button>
          </nav>
        </template>
        <template x-if="inset.mode === 'edit'">
          <nav class="inset">
            <span>Edit:</span>
            <input :value="display_key(m_et.key)"
              class="nt_key"
              disabled
              name="nt_key" />
            <input class="nt_title"
              name="nt_title"
              placeholder="Title..."
              x-model="m_et.title" />
            <input class="nt_title"
              name="nt_description"
              placeholder="Description..."
              x-model="m_et.description" />
            <button @click="inset.mode = 'create'" class="btn-cross"></button>
          </nav>
        </template>

        <h2>All Tickets:</h2>
        <span
          x-text="`#tickets ${parseInt(Object.keys(tickets).length)}`"></span>
        <table class="ticket-table">
          <template
            x-for="ti in parseInt(Object.keys(tickets).length)"
            :key="tickets[ti].key">
            <tr :id="display_key(t.key)"
              @click="edit_ticket(t.key)"
              @mouseover="ui_hover_ticket($event, t.key)"
              @mousemove="ui_hover_ticket($event, t.key)"
              @mouseleave="ui_hover_ticket($event, 0)"
              class="ticket"
              :class="t.key == m_table.highlight_key ? 'highlight': ''"
              x-data="{ t: tickets[ti] }">
              <td>
                <img
                  :alt="name_types[t.type]"
                  :src="`/static/ui/icons/type_${t.type}.svg`"
                  :title="name_types[t.type]" />
                <template x-if="t.parent !== null">
                  <a :href="'##'+t.parent"
                    class="ticket parent" x-text="display_key(t.parent)">
                  </a>
                </template>
                <template x-if="t.parent !== null">
                  <span>âž¤</span>
                </template>
                <a class="ticket" :href="display_key(t.key)"
                  x-text="display_key(t.key)"></a>
              </td>
              <td>
                <img :alt="name_priorities[t.priority]"
                  :src="priority_icon(t.priority)"
                  :title="name_priorities[t.priority]"
                  width="32" />
              </td>
              <td x-text="name_statuses[t.status]"></td>
              <td class="title" x-text="t.title"></td>
              <!-- <td class="desciption" x-text="t.description"></td> -->
              <td>
                <button @click="ui_delete_ticket(t.key)" class="btn-cross">
                </button>
              </td>
            </tr>
          </template>
        </table>
      </section>

      <template x-if="right_panel.mode === ''">
        <aside class="right hidden"></aside>
      </template>
      <template x-if="right_panel.mode === 'edit'">
        <aside class="right edit"></aside>
      </template>
    </main>

    <template x-if="m_tooltip.key">
      <div id="tooltip" class="tooltip"
        x-data="{
          t: tickets[m_tooltip.key]
        }"
        :style="`left: ${m_tooltip.position[0]}px; top: ${m_tooltip.position[1]+24}px;`">
        <img
          :alt="name_types[t.type]"
          :src="`/static/ui/icons/type_${t.type}.svg`"
          :title="name_types[t.type]" />
        <template x-if="t.parent !== null">
          <a :href="'##'+t.parent"
            class="ticket parent" x-text="display_key(t.parent)">
          </a>
        </template>
        <span x-text="display_key(m_tooltip.key)"></span>
        <span x-text="tickets[m_tooltip.key].title"></span>
        <span x-text="tickets[m_tooltip.key].description"></span>
      </div>
    </template>
  </body>
</html>
