<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>GOFast</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="/static/ui/icons/favicon.svg">
  <link rel="stylesheet" href="/static/ui/index.css">

  <!-- ROBOTO -->
  <!-- <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> -->
  <!-- <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
    rel="stylesheet"> -->

  <!-- ROBOTO CONDENSED -->
  <!-- <link rel="preconnect" href="https://fonts.googleapis.com"> -->
  <!-- <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> -->
  <!-- <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@100..900&display=swap" rel="stylesheet"> -->

  <script src="https://cdn.jsdelivr.net/npm/d3@7" defer></script>
  <script src="/static/ui/gofast.js" defer></script>
  <script src="/static/ui/graph.js" defer></script>
  <script src="https://unpkg.com/alpinejs" defer></script>
</head>

<body x-data="GOFAST">
  <!-- TODO: Graphs! -->
  <!-- <div id="container"></div> -->

  <main id="main">
    <!-- Make a side-panel -->
    <aside :class="`left`" x-show="left_panel.mode === 'edit'" x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 transform scale-90" x-transition:enter-end="opacity-100 transform scale-100"
      x-transition:leave="transition ease-in duration-300" x-transition:leave-start="opacity-100 transform scale-100"
      x-transition:leave-end="opacity-0 transform scale-90">
      <span>Edit:</span>
      <input name="nt_key" class="nt_key" :value="display_key(m_et.key)" disabled>
      <input name="nt_title" class="nt_title" placeholder="Title..." x-model="m_et.title">
      <textarea name="nt_description" class="description" placeholder="Description..."
        x-model="m_et.description"></textarea>
      <button class="btn-cross" @click="left_panel.mode = ''"></button>
    </aside>
    <!-- <template x-if="left_panel.mode === ''">
      <aside class="left hidden"></aside>
    </template> -->

    <section>
      <template x-if="inset.mode === 'create'">
        <!-- Make new ticket -->
        <nav class="inset">
          <span>New:</span>
          <!-- TODO: Make an expand button to enlarge the inset. -->
          <input name="nt_key" class="nt_key" :value="display_key(likely_next_ticket_number())" disabled>
          <input name="nt_title" class="nt_title" placeholder="Title..." x-model="m_nt.title">
          <input name="nt_description" class="nt_title" placeholder="Description..." x-model="m_nt.description">
          <!-- TODO: Add a 'search' field/dropdown combo thing for finding parents. -->
          <button class="btn-plus" @click="ui_create_ticket"></button>
        </nav>
      </template>
      <template x-if="inset.mode === 'edit'">
        <nav class="inset">
          <span>Edit:</span>
          <input name="nt_key" class="nt_key" :value="display_key(m_et.key)" disabled>
          <input name="nt_title" class="nt_title" placeholder="Title..." x-model="m_et.title">
          <input name="nt_description" class="nt_title" placeholder="Description..." x-model="m_et.description">
          <button class="btn-cross" @click="inset.mode = 'create'"></button>
        </nav>
      </template>

      <h2>All Tickets:</h2>
      <span x-text=" parseInt(Object.keys(tickets).length)"></span>
      <table class="ticket-table">
        <template x-for="ti in parseInt(Object.keys(tickets).length)" :key="tickets[ti].key">
          <tr class="ticket" x-data="{ t: tickets[ti] }" :id="display_key(t.key)" @click="edit_ticket(t.key)">
            <td>
              <img :alt="t.type" :title="name_types[t.type]" :src="`/static/ui/icons/type_${t.type}.svg`">
              <a :href="display_key(t.key)" x-text="display_key(t.key)"></span>
            </td>
            <td><img :alt="t.priority" :title="name_priorities[t.priority]" :src="priority_icon(t.priority)" width="32">
            </td>
            <td x-text="name_statuses[t.status]"></td>
            <td x-text="t.title" class="title"></td>
            <td x-text="t.description" class="desciption"></td>
            <td>
              <template x-if="t.parent !== null">
                <a class="ticket parent" :href="'##'+t.parent">
                  <span x-text="display_key(t.parent)"></span>
                  <!-- <span x-text="tickets[t.parent].title"></span> -->
                </a>
              </template>
            </td>
            <td><button class="btn-cross" @click="ui_delete_ticket(t.key)"></button></td>
          </tr>
        </template>
      </table>
    </section>
    <template x-if="right_panel.mode === ''">
      <aside class="right hidden"></aside>
    </template>
    <template x-if="right_panel.mode === 'edit'">
      <aside :class="`right ${right_panel.mode}`">

      </aside>
    </template>

  </main>
</body>

</html>