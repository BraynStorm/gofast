<div class="ticket-search">
  <input type="search" placeholder="Search...">

  <!-- Grid-checkboxes for Priority -->
  <div class="grid" x-data="{ prop:'priority' }">
    <button class="sort" x-text="
      let index = m_table.order.findIndex(x => x[0] === prop)
      if (index === -1) { 
        return '--';
      } else {
        let direction = m_table.order[index][1];
         
        return `${parseInt(index)+1} ${direction == 0 ? '' : direction > 0 ? '↑' : '↓'}`;
      }
    " @click="
    let v = m_table.order.find(x => x[0] === prop);
    v[1] += 1; if (v[1] >= 2) v[1] -= 3;
    "></button>
    <!--
    TODO - Right-click => 0
    TODO - Remove from list on 0? There's gotta be a way for the user to move the list's order. Drag? -->
    <!-- <div x-text="m_table.search[prop].map(x=>priority_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names[prop]" :key="id">
      <div :class="m_table.search[prop].includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search[prop].includes(id)) {
            m_table.search[prop].push(id);
          } else {
            array_remove(m_table.search[prop], id);
          }
          m_table.search[prop].sort();
        ">
        <img :src="priority_icon(id)">
      </div>
    </template>
  </div>

  <!-- Grid-checkboxes for Type -->
  <div class="grid">
    <!-- <div x-text="m_table.search.type.map(x=>type_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names.type" :key="id">
      <div :class="m_table.search.type.includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search.type.includes(id)) {
              m_table.search.type.push(id);
          } else {
             array_remove(m_table.search.type, id);
          }
          m_table.search.type.sort();
        ">
        <img :src="type_icon(id)">
        <!-- <span x-text="type_name(id)"></span> -->
      </div>
    </template>
  </div>

  <!-- Grid-checkboxes for Status -->
  <div class="grid">
    <!-- <div x-text="m_table.search.status.map(x=>status_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names.status" :key="id">
      <div :class="m_table.search.status.includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search.status.includes(id)) {
              m_table.search.status.push(id);
          } else {
             array_remove(m_table.search.status, id);
          }
          m_table.search.status.sort();
        ">
        <!-- <img :src="status_icon(id)"> -->
        <span x-text="status_name(id)"></span>
      </div>
    </template>
  </div>
</div>

<div class="ticket-table">
  <table>
    <template
      x-for="[key, t] of ui_filter_tickets()"
      :key="key">
      <tr :id="display_key(t.key)"
        @click="edit_ticket(t.key)"
        @mousemove="ui_hover_ticket($event, t.key)"
        @mouseleave="ui_hover_ticket($event, 0)"
        class="ticket"
        :class="t.key == m_table.highlight_key ? 'highlight': ''">
        <td>
          <img :src="type_icon(t.type)" :title="type_name(t.type)" />
          <a class="ticket" :href="display_key(t.key)"
            x-text="display_key(t.key)"></a>
        </td>
        <td class="icon">
          <img :src="priority_icon(t.priority)"
            :title="priority_name(t.priority)" />
        </td>
        <!-- Progress bar -->
        <td x-data="progress(t.key)">
          <div class="progress-bar"
            x-data="{ p: (estimate > 0 ? spent/estimate : 0), left: estimate - spent}"
            x-text="`${fmt_time(left)} (${parseInt(Math.min(p, 1)*100)}%)`">
          </div>
        </td>
        <td x-text="status_name(t.status)"></td>
        <td class="title" x-text="t.title"></td>
      </tr>
    </template>
  </table>
</div>