<div class="ticket-search">
  <input type="search" placeholder="Search...">

  <!-- Grid-checkboxes for Priority -->
  <div class="grid" x-data="{ o: false , pr: '' }"
    @click.outside="o=false;">
    <!-- <div x-text="m_table.search.priority.map(x=>priority_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names.priority" :key="id">
      <div :class="m_table.search.priority.includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search.priority.includes(id)) {
              m_table.search.priority.push(id);
          } else {
             array_remove(m_table.search.priority, id);
          }
          m_table.search.priority.sort();
        ">
        <img :src="priority_icon(id)">
        <!-- <span x-text="priority_name(id)"></span> -->
      </div>
    </template>
  </div>

  <!-- Grid-checkboxes for Type -->
  <div class="grid" x-data="{ o: false , pr: '' }"
    @click.outside="o=false;">
    <!-- <div x-text="m_table.search.type.map(x=>type_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names.type" :key="id">
      <div :class="m_table.search.type.includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search.type.includes(id)) {
              m_table.search.type.push(id);
          } else {
             array_remove(m_table.search.type, id);
          }
          m_table.search.type.sort();
        ">
        <img :src="type_icon(id)">
        <!-- <span x-text="type_name(id)"></span> -->
      </div>
    </template>
  </div>

  <!-- Grid-checkboxes for Status -->
  <div class="grid" x-data="{ o: false , pr: '' }"
    @click.outside="o=false;">
    <!-- <div x-text="m_table.search.status.map(x=>status_name(x)).join(', ')"></div> -->
    <template x-for="_, id in names.status" :key="id">
      <div :class="m_table.search.status.includes(id) ? 'selected' : ''"
        @click="
          if (!m_table.search.status.includes(id)) {
              m_table.search.status.push(id);
          } else {
             array_remove(m_table.search.status, id);
          }
          m_table.search.status.sort();
        ">
        <!-- <img :src="status_icon(id)"> -->
        <span x-text="status_name(id)"></span>
      </div>
    </template>
  </div>
</div>

<div class="ticket-table">
  <table>
    <template
      x-for="(t, key) in ui_filter_tickets(tickets)"
      :key="key">
      <tr :id="display_key(t.key)"
        @click="edit_ticket(t.key)"
        @mouseover="ui_hover_ticket($event, t.key)"
        @mousemove="ui_hover_ticket($event, t.key)"
        @mouseleave="ui_hover_ticket($event, 0)"
        class="ticket"
        :class="t.key == m_table.highlight_key ? 'highlight': ''">
        <td>
          <img :src="type_icon(t.type)" :title="type_name(t.type)" />
          <a class="ticket" :href="display_key(t.key)"
            x-text="display_key(t.key)"></a>
        </td>
        <td>
          <img :src="priority_icon(t.priority)"
            :title="priority_name(t.priority)" />
        </td>
        <td x-data="progress(t.key)">
          <!-- Progress bar -->
          <div class="progress-bar"
            x-data="{ p: (estimate > 0 ? spent/estimate : 0), left: estimate - spent}"
            x-text="`${fmt_time(left)} (${parseInt(Math.min(p, 1)*100)}%)`">

          </div>
        </td>
        <td x-text="status_name(t.status)"></td>
        <td class="title" x-text="t.title"></td>
        <!-- <td class="desciption" x-text="t.description"></td> -->
        <!-- <td>
          <button class="btn-cross"
            @click="ui_delete_ticket(t.key)"></button>
        </td> -->
      </tr>
    </template>
  </table>
</div>